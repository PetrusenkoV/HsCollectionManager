@model HsCollectionManager.Models.SelectCards

@{
    ViewBag.Title = "AllCards";
}
<link href="~/Content/HideButtons.css" rel="stylesheet" />
<h2>AllCards</h2>

@foreach (var item in Model.Cards.Take(4))
{
    <div style="float: left; width: 280px;">
        <h3 style="text-align: center">@item.Name</h3>
        <img src="@item.Img" />
        <button class="1">Add</button>
        <button class="2 visible">Remove</button>
    </div>
}
@foreach (var item in Model.Cards.Skip(4).Take(4))
{
    <div style="float: left; width: 280px;">
        <h3 style="text-align: center">@item.Name</h3>
        <img src="@item.Img" />
        <button class="1">Add</button>
        <button class="2 visible">Remove</button>
    </div>
}
<div style="clear: left; margin: 20px">
    
    @Html.ActionLink("Prev", "ShowAllCards", "Home", new { UserName = Model.UserName, UserId = Model.UserId, page = @Model.PageInfo.CurrentPage - 1 },
    new { @style = "clear: left", @class = Model.PageInfo.CurrentPage == 1 ? "btn btn-success hidden" : "btn btn-success" })

    @Html.ActionLink("Next", "ShowAllCards", "Home", new { UserName = Model.UserName, UserId = Model.UserId, page = @Model.PageInfo.CurrentPage + 1 },
    new { @style = "clear: left", @class = Model.PageInfo.CurrentPage == Model.PageInfo.TotalPages ? "btn btn-success hidden" : "btn btn-success" })

    

    @Html.ActionLink("Finish", "Index", null, new { @class = "btn btn-success" })
</div>
<script>
    var addToCollection = function () {
        var img = this.parentElement.getElementsByTagName('img');

        $.ajax({
            type: "POST",
            url: "/Home/InsertUserCard",
            content: "application/json; charset=utf-8",
            dataType: "json",
            data: { CardImg: img[0].src, UserId: "@Model.UserId" },
            success: function () {
            },
            error: function (xhr, textStatus, errorThrown) {
                // TODO: Show error
            }
        });

        var btns = this.parentElement.getElementsByTagName('button');
        for (var i = 0; i < btns.length; i++) {
            btns[i].classList.toggle("visible");
        }
    }

    var removeFromCollection = function () {
        var img = this.parentElement.getElementsByTagName('img');

        $.ajax({
            type: "POST",
            url: "/Home/RemoveFromCollection",
            content: "application/json; charset=utf-8",
            dataType: "json",
            data: { CardImg: img[0].src, UserId: "@Model.UserId" },
            success: function () {
            },
            error: function (xhr, textStatus, errorThrown) {
                // TODO: Show error
            }
        });

        var btns = this.parentElement.getElementsByTagName('button');
        for (var i = 0; i < btns.length; i++) {
            btns[i].classList.toggle("visible");
        }
    }

    var btns1 = document.getElementsByClassName('1');
    for (var i = 0; i < btns1.length; i++) {
        btns1[i].addEventListener("click", addToCollection);
    }

    var btns2 = document.getElementsByClassName('2');
    for (var i = 0; i < btns2.length; i++) {
        btns2[i].addEventListener("click", removeFromCollection);
    }
</script>








